# 콘서트 예약 시스템 - 유저플로우 (User Flow)

> 본 문서는 콘서트 예약 시스템의 주요 기능별 유저플로우를 상세히 정의합니다.
> 각 유저플로우는 입력(Input), 처리(Process), 출력(Output) 단계로 구성되며, 예상 가능한 엣지케이스를 포함합니다.

**문서 버전**: 1.0
**작성일**: 2025-10-16
**최종 수정일**: 2025-10-16

---

## 목차

1. [콘서트 목록 조회 및 검색](#1-콘서트-목록-조회-및-검색)
2. [콘서트 상세 조회](#2-콘서트-상세-조회)
3. [좌석 선택 및 예약](#3-좌석-선택-및-예약)
4. [예약 내역 조회](#4-예약-내역-조회)
5. [예약 상세 조회](#5-예약-상세-조회)
6. [예약 취소](#6-예약-취소)

---

## 1. 콘서트 목록 조회 및 검색

### 1.1 입력 (Input)
- 사용자가 홈페이지 또는 콘서트 목록 페이지 접근
- 검색창에 키워드 입력 (콘서트 제목, 출연진, 장소)
- 필터 옵션 선택 (장르, 날짜 범위, 지역, 가격대)
- 정렬 옵션 선택 (최신순, 인기순, 가격순)
- 스크롤 또는 페이지네이션 버튼 클릭

### 1.2 처리 (Process)
1. 페이지 진입 시 기본 콘서트 목록 데이터 요청
2. 스켈레톤 UI 표시
3. 서버에서 기본 목록 조회 (페이지네이션 적용, 기본 정렬: 최신순)
4. 검색 입력 시:
   - 입력 디바운싱 처리 (300ms)
   - 검색 쿼리와 함께 API 요청
   - 검색 결과가 없을 경우 빈 상태 처리
5. 필터 적용 시:
   - 선택된 필터 조합으로 API 요청
   - 기존 검색어와 필터 조합 적용
   - 필터 결과가 없을 경우 빈 상태 처리
6. 정렬 변경 시:
   - 현재 검색어/필터 조건 유지하며 정렬만 변경
   - 정렬된 결과로 목록 재조회
7. 스크롤/페이지네이션:
   - 다음 페이지 데이터 요청
   - 기존 목록에 추가 (무한 스크롤) 또는 교체 (페이지네이션)
8. 에러 발생 시:
   - 네트워크 에러: 재시도 옵션 제공
   - 서버 에러: 에러 메시지 표시
   - 타임아웃: 재시도 옵션 제공

### 1.3 출력 (Output)
- 콘서트 목록 카드 표시 (포스터, 제목, 장소, 날짜, 가격)
- 검색 결과 건수 표시
- 적용된 필터 태그 표시 (제거 가능)
- 로딩 중: 스켈레톤 UI 표시
- 검색 결과 없음: 빈 상태 메시지 및 필터 초기화 버튼
- 에러 발생: 에러 메시지 및 재시도 버튼
- 페이지 URL에 검색/필터 파라미터 반영 (공유 가능)

### 1.4 엣지케이스
- 네트워크 연결 끊김: 에러 메시지 및 재시도 옵션
- 검색어가 특수문자만 포함: 유효성 검사 및 안내 메시지
- 필터 조합 결과가 0건: 빈 상태 및 필터 완화 제안
- 동시에 여러 필터 변경: 마지막 변경만 적용 (디바운싱)
- 페이지 새로고침: URL 파라미터 기반으로 상태 복원
- API 응답 지연: 타임아웃 처리 (10초) 및 에러 안내
- 중복 API 요청: 진행 중인 요청 취소 후 새 요청 실행

---

## 2. 콘서트 상세 조회

### 2.1 입력 (Input)
- 콘서트 목록에서 특정 콘서트 카드 클릭
- 직접 URL로 콘서트 상세 페이지 접근 (`/concerts/[id]`)
- 공연 날짜/시간 선택 (여러 회차가 있는 경우)
- 위시리스트 추가/제거 버튼 클릭
- 공유하기 버튼 클릭
- 좌석 선택 버튼 클릭
- 뒤로가기 버튼 클릭

### 2.2 처리 (Process)
1. 페이지 진입 시:
   - URL에서 콘서트 ID 추출
   - 콘서트 상세 정보 API 요청
   - 스켈레톤 UI 표시
   - 콘서트 ID가 유효하지 않은 경우 404 처리

2. 콘서트 데이터 로드:
   - 기본 정보 조회 (제목, 포스터, 출연진, 장르, 관람등급)
   - 공연 정보 조회 (날짜, 시간, 장소, 러닝타임)
   - 가격 정보 조회 (좌석 등급별 가격)
   - 예매 가능 여부 확인
   - 회차 정보 조회 (여러 공연이 있는 경우)

3. 공연 날짜/시간 선택 시:
   - 선택된 회차 정보 저장 (로컬 상태)
   - 해당 회차의 좌석 예매 가능 여부 확인
   - 매진된 회차: 선택 불가 상태로 표시

4. 위시리스트 추가/제거:
   - 로그인 상태 확인
   - 비로그인 시: 로그인 페이지로 리다이렉트 (현재 페이지 저장)
   - 로그인 시: 위시리스트 추가/제거 API 요청
   - 낙관적 업데이트 적용 (즉시 UI 반영)
   - API 실패 시: 이전 상태로 롤백 및 에러 메시지

5. 공유하기:
   - 공유 모달 표시
   - 현재 페이지 URL 클립보드 복사
   - SNS 공유 링크 생성 (선택 시)

6. 좌석 선택 버튼 클릭:
   - 공연 날짜/시간 선택 여부 확인
   - 미선택 시: 회차 선택 안내 메시지
   - 선택 완료 시: 좌석 선택 페이지로 이동 (선택 정보 전달)
   - 매진된 회차: 버튼 비활성화 및 안내

7. 에러 처리:
   - 콘서트가 존재하지 않음: 404 페이지
   - 콘서트가 삭제됨: 안내 메시지 및 목록으로 이동
   - 네트워크 에러: 재시도 옵션
   - API 타임아웃: 재시도 옵션

### 2.3 출력 (Output)
- 콘서트 상세 정보 표시:
  - 히어로 섹션 (포스터, 제목, 주요 정보)
  - 공연 정보 섹션
  - 가격 정보 테이블
  - 상세 설명 및 출연진 정보
  - 장소 정보 및 지도

- 회차 선택 UI:
  - 선택 가능/매진 상태 구분 표시
  - 선택된 회차 하이라이트

- 위시리스트 버튼 상태:
  - 추가됨: 채워진 하트 아이콘
  - 미추가: 빈 하트 아이콘
  - 로딩 중: 스피너 표시

- 좌석 선택 버튼:
  - 회차 미선택 시: 비활성화 상태
  - 매진 시: 비활성화 및 "매진" 표시
  - 예매 가능 시: 활성화 및 스티키 위치

- 로딩 상태: 스켈레톤 UI
- 에러 상태: 에러 메시지 및 액션 버튼
- 공유 완료: 토스트 메시지

### 2.4 엣지케이스
- 유효하지 않은 콘서트 ID: 404 페이지 표시
- 콘서트가 삭제됨: 안내 후 목록으로 리다이렉트
- 이미 지난 공연: "지난 공연" 배지 및 예매 불가
- 예매 오픈 전: 오픈 일시 안내 및 알림 설정 옵션
- 모든 회차 매진: "매진" 상태 및 대기 알림 옵션
- 비로그인 상태에서 위시리스트: 로그인 모달 표시
- 네트워크 연결 끊김: 캐시된 데이터 표시 (있는 경우) 또는 에러
- 동시에 여러 회차 선택 시도: 마지막 선택만 적용
- 공유 API 미지원 브라우저: URL 복사로 대체
- 이미지 로드 실패: 대체 이미지(placeholder) 표시
- 긴 콘서트 제목/설명: 적절히 truncate 및 "더보기" 옵션

---

## 3. 좌석 선택 및 예약

### 3.1 입력 (Input)
- 콘서트 상세 페이지에서 좌석 선택 버튼 클릭
- 좌석도 확대/축소/드래그 조작
- 개별 좌석 클릭 (선택/해제)
- 좌석 등급 필터 선택
- 선택한 좌석 삭제 버튼 클릭
- 예약하기 버튼 클릭
- 페이지 이탈 시도 (뒤로가기, 브라우저 닫기)

### 3.2 처리 (Process)
1. 페이지 진입 시:
   - 선택된 콘서트 및 회차 정보 확인
   - 정보 없을 시: 콘서트 상세 페이지로 리다이렉트
   - 로그인 상태 확인
   - 비로그인 시: 로그인 페이지로 리다이렉트 (돌아올 경로 저장)
   - 좌석도 데이터 API 요청
   - 타이머 시작 (10분)

2. 좌석도 데이터 로드:
   - 공연장 좌석 배치 정보 조회
   - 각 좌석의 상태 조회 (선택가능/예약됨/임시예약/판매불가)
   - 좌석 등급별 가격 정보 조회
   - 실시간 좌석 상태 폴링 시작 (5초 간격)

3. 좌석 선택 시:
   - 좌석 상태 확인:
     - 이미 예약됨: 선택 불가, 안내 메시지
     - 다른 사용자 임시예약 중: 선택 불가
     - 판매 불가: 선택 불가
   - 선택 가능 좌석:
     - 현재 선택 좌석 수 확인 (최대 4석)
     - 최대 초과 시: 안내 메시지 및 선택 불가
     - 임시 예약 API 요청 (낙관적 업데이트)
     - 성공 시: 선택 목록에 추가, UI 업데이트
     - 실패 시: 롤백 및 에러 메시지 (다른 사용자가 먼저 선택)

4. 좌석 해제 시:
   - 선택 목록에서 제거
   - 임시 예약 해제 API 요청
   - UI 즉시 업데이트

5. 타이머 관리:
   - 매초 남은 시간 업데이트
   - 3분 남았을 때: 경고 메시지
   - 1분 남았을 때: 강조 경고 메시지
   - 시간 종료 시:
     - 모든 임시 예약 자동 해제
     - 안내 메시지 표시
     - 콘서트 상세 페이지로 리다이렉트

6. 좌석도 조작:
   - 확대/축소: 좌표 계산 및 뷰포트 조정
   - 드래그: 좌석도 이동 (모바일: 터치 제스처)
   - 모바일: 핀치 줌 지원

7. 좌석 등급 필터:
   - 선택된 등급만 하이라이트
   - 다른 등급은 반투명 처리
   - 필터 해제: 전체 표시

8. 예약하기 버튼 클릭:
   - 좌석 선택 여부 확인
   - 미선택 시: 안내 메시지
   - 선택 완료 시:
     - 최종 확인 다이얼로그 표시
     - 사용자 확인 후:
       - 중복 클릭 방지 (버튼 비활성화)
       - 예약 생성 API 요청
       - 로딩 인디케이터 표시
     - 서버 처리:
       - 임시 예약을 정식 예약으로 전환
       - 예약 번호 생성
       - 예약 정보 저장
       - 이메일/SMS 알림 발송 트리거
     - 예약 완료:
       - 예약 완료 페이지로 리다이렉트
       - 예약 번호 및 정보 표시

9. 페이지 이탈 시도:
   - 선택된 좌석이 있는 경우: 확인 다이얼로그
   - 확인 시: 임시 예약 해제 API 요청 후 이탈
   - 취소 시: 페이지 유지

10. 에러 처리:
    - 좌석도 로드 실패: 재시도 옵션
    - 임시 예약 실패: 에러 메시지 및 좌석 선택 해제
    - 예약 생성 실패: 에러 메시지 및 재시도 옵션
    - 네트워크 끊김: 타이머 일시정지, 재연결 시 상태 동기화
    - 세션 만료: 로그인 페이지로 리다이렉트

### 3.3 출력 (Output)
- 좌석도 렌더링:
  - 좌석 상태별 색상 구분
  - 좌석 등급별 영역 구분
  - 무대 위치 표시

- 선택 정보 패널:
  - 선택한 좌석 목록 (등급, 좌석번호, 가격)
  - 총 선택 좌석 수
  - 총 금액
  - 개별 좌석 삭제 버튼

- 타이머 표시:
  - 남은 시간 (MM:SS 형식)
  - 3분 이하: 주황색 경고
  - 1분 이하: 빨간색 강조

- 범례:
  - 선택 가능, 선택됨, 예약됨, 판매불가 색상 안내
  - 좌석 등급별 색상 및 가격

- 예약하기 버튼:
  - 좌석 미선택 시: 비활성화
  - 좌석 선택 시: 활성화 및 선택 수 표시

- 최종 확인 다이얼로그:
  - 선택한 좌석 정보 요약
  - 총 금액
  - 확인/취소 버튼

- 예약 완료 페이지:
  - 성공 메시지
  - 예약 번호
  - 예약 정보 요약
  - 마이페이지로 이동 버튼

- 로딩 상태: 스켈레톤 좌석도, 예약 처리 중 로딩 모달
- 에러 상태: 에러 메시지 및 재시도 버튼
- 토스트 메시지:
  - 좌석 선택 성공
  - 좌석 해제
  - 최대 선택 수 초과
  - 이미 예약된 좌석
  - 시간 경고

### 3.4 엣지케이스
- 콘서트/회차 정보 없음: 상세 페이지로 리다이렉트
- 비로그인 상태: 로그인 페이지로 리다이렉트
- 이미 매진된 회차: 안내 후 상세 페이지로 리다이렉트
- 타이머 만료: 임시 예약 자동 해제 및 리다이렉트
- 동시 선택 충돌: 먼저 선택한 사용자 우선, 나머지는 실패 처리
- 네트워크 끊김 중 타이머 만료: 재연결 시 상태 확인 및 처리
- 브라우저 탭 여러 개: 한 탭에서만 예약 진행 (다른 탭은 세션 충돌 안내)
- 페이지 새로고침: 임시 예약 유지 확인, 타이머 동기화
- 모바일 화면 회전: 좌석도 뷰포트 재계산
- 좌석도 렌더링 실패: 목록 형태로 대체 UI 제공
- API 응답 지연: 로딩 인디케이터 및 타임아웃 처리
- 선택 중 다른 사용자가 해당 좌석 예약: 실시간 동기화로 자동 해제 및 알림
- 매우 큰 좌석도: 가상 스크롤 또는 레벨별 로드 적용
- 예약 완료 후 페이지 새로고침: 예약 완료 페이지 유지 또는 마이페이지로 리다이렉트
- 예약 생성 중 네트워크 끊김: 재연결 시 예약 상태 확인 (중복 방지)

---

## 4. 예약 내역 조회

### 4.1 입력 (Input)
- 마이페이지 메뉴 클릭
- 예약 내역 페이지 접근 (`/my/bookings`)
- 상태별 필터 선택 (예정/지난 공연/취소)
- 개별 예약 카드 클릭
- 검색창에 콘서트명 입력
- 정렬 옵션 선택 (날짜순, 최신 예약순)
- 페이지네이션/무한 스크롤
- 새로고침

### 4.2 처리 (Process)
1. 페이지 진입 시:
   - 로그인 상태 확인
   - 비로그인 시: 로그인 페이지로 리다이렉트 (돌아올 경로 저장)
   - 로그인 시: 사용자 예약 목록 API 요청
   - 기본 필터: 예정된 공연
   - 기본 정렬: 공연 날짜순 (가까운 순)

2. 예약 목록 조회:
   - 사용자 ID로 예약 내역 조회
   - 각 예약의 상태 계산:
     - 예정: 공연 날짜가 미래
     - 지난 공연: 공연 날짜가 과거
     - 취소: 취소 처리된 예약
   - 각 예약의 콘서트 정보 포함 (제목, 포스터, 날짜, 장소)
   - 좌석 정보 포함
   - D-day 계산 (예정된 공연의 경우)

3. 상태별 필터 선택:
   - 선택된 상태로 목록 재조회
   - URL 파라미터 업데이트
   - 해당 상태의 예약 수 표시
   - 결과 없을 시: 빈 상태 메시지

4. 검색:
   - 입력 디바운싱 (300ms)
   - 콘서트 제목으로 예약 내역 필터링
   - 검색 결과 건수 표시
   - 결과 없을 시: 빈 상태 및 검색어 초기화 옵션

5. 정렬:
   - 날짜순: 공연 날짜 기준 (예정: 가까운 순, 지난: 최근 순)
   - 최신 예약순: 예약 생성일 기준 내림차순
   - 선택된 정렬로 목록 재정렬

6. 페이지네이션/무한 스크롤:
   - 페이지당 10개 항목
   - 다음 페이지 요청
   - 로딩 인디케이터 표시
   - 마지막 페이지: 더보기 버튼 숨김

7. 새로고침:
   - 최신 상태로 목록 재조회
   - 현재 필터/정렬 유지
   - 낙관적 업데이트 데이터 동기화

8. 에러 처리:
   - 네트워크 에러: 재시도 옵션
   - 세션 만료: 로그인 페이지로 리다이렉트
   - API 타임아웃: 재시도 옵션
   - 서버 에러: 에러 메시지 표시

### 4.3 출력 (Output)
- 예약 내역 목록:
  - 예약 카드 (콘서트 포스터, 제목, 날짜, 장소)
  - D-day 배지 (예정된 공연)
  - 상태 배지 (예정/완료/취소)
  - 좌석 정보 요약
  - 예약 번호

- 상태별 탭:
  - 예정 (건수)
  - 지난 공연 (건수)
  - 취소 (건수)
  - 선택된 탭 하이라이트

- 검색 및 정렬 UI:
  - 검색창
  - 정렬 드롭다운

- 빈 상태:
  - 예약 내역 없음: 안내 메시지 및 콘서트 둘러보기 버튼
  - 검색 결과 없음: 안내 메시지 및 검색 초기화 버튼
  - 필터 결과 없음: 안내 메시지

- 로딩 상태:
  - 초기 로드: 스켈레톤 카드
  - 페이지네이션 로드: 하단 스피너

- 에러 상태:
  - 에러 메시지
  - 재시도 버튼

### 4.4 엣지케이스
- 비로그인 상태: 로그인 페이지로 리다이렉트
- 예약 내역 없음: 빈 상태 메시지 및 탐색 유도
- 모든 예약이 취소됨: 취소 탭에만 내역 표시
- 동일 콘서트 여러 예약: 각각 별도 카드로 표시
- 공연 시작 직전 (1시간 이내): 강조 표시 및 알림
- 취소된 예약의 환불 진행 중: 환불 상태 표시
- 네트워크 끊김: 캐시된 데이터 표시 (오프라인 배지)
- 페이지 새로고침: URL 파라미터 기반 상태 복원
- 삭제된 콘서트: 예약 정보는 유지, "공연 취소" 배지
- 매우 많은 예약 내역 (100개 이상): 가상 스크롤 적용
- 좌석 정보 누락: 대체 텍스트 표시
- 포스터 이미지 없음: 대체 이미지 표시
- 검색어가 매우 긴 경우: Truncate 처리
- 동시에 여러 필터 변경: 디바운싱 처리
- 뒤로가기 후 재진입: 이전 필터/정렬 상태 복원

---

## 5. 예약 상세 조회

### 5.1 입력 (Input)
- 예약 내역 목록에서 개별 예약 카드 클릭
- 직접 URL로 예약 상세 페이지 접근 (`/my/bookings/[id]`)
- 티켓/QR코드 확대 버튼 클릭
- 티켓 다운로드 버튼 클릭
- 티켓 공유 버튼 클릭
- 예약 취소 버튼 클릭
- 캘린더에 추가 버튼 클릭
- 장소 지도 보기 클릭
- 뒤로가기 버튼 클릭

### 5.2 처리 (Process)
1. 페이지 진입 시:
   - 로그인 상태 확인
   - 비로그인 시: 로그인 페이지로 리다이렉트
   - URL에서 예약 ID 추출
   - 예약 상세 정보 API 요청
   - 스켈레톤 UI 표시

2. 예약 상세 정보 로드:
   - 예약 ID로 상세 정보 조회
   - 예약 소유자 확인 (현재 사용자와 일치 여부)
   - 불일치 시: 403 에러 처리
   - 예약이 존재하지 않음: 404 에러 처리
   - 예약 정보:
     - 예약 번호, 예약 날짜
     - 예약 상태 (확정/취소)
     - 콘서트 정보 (제목, 포스터, 날짜, 시간, 장소, 출연진)
     - 좌석 정보 (등급, 좌석번호 목록)
     - 취소 가능 여부
   - QR코드 생성 (예약 번호 기반)
   - D-day 계산

3. 티켓/QR코드 확대:
   - 전체화면 모달 표시
   - QR코드 고해상도로 렌더링
   - 화면 밝기 자동 증가 (모바일)
   - 스크린샷 방지 설정 (보안 옵션)

4. 티켓 다운로드:
   - 티켓 이미지 생성 (예약 정보 + QR코드)
   - 이미지 다운로드 (PNG/PDF 형식)
   - 다운로드 완료 토스트 메시지
   - 다운로드 실패 시: 에러 안내 및 재시도

5. 티켓 공유:
   - 공유 모달 표시
   - 공유 옵션:
     - URL 복사 (예약 상세 페이지)
     - 이메일 전송
     - SMS 전송
   - 공유 완료 토스트 메시지

6. 캘린더에 추가:
   - 캘린더 이벤트 파일 생성 (.ics)
   - 이벤트 정보:
     - 제목: 콘서트명
     - 날짜/시간: 공연 시작 시간
     - 장소: 공연장 주소
     - 알림: 공연 3시간 전
   - 파일 다운로드
   - 모바일: 네이티브 캘린더 앱으로 전달

7. 장소 지도 보기:
   - 지도 모달 표시
   - 공연장 위치 마커 표시
   - 길찾기 버튼 (외부 지도 앱 연동)
   - 주소 복사 버튼

8. 예약 취소 버튼 클릭:
   - 취소 가능 여부 확인:
     - 이미 취소됨: 버튼 비활성화
     - 공연 종료: 취소 불가 안내
     - 취소 가능 기간 지남: 취소 불가 안내
   - 취소 가능 시: 취소 프로세스로 이동

9. 에러 처리:
   - 예약 정보 없음: 404 페이지
   - 권한 없음 (다른 사용자 예약): 403 에러
   - QR코드 생성 실패: 대체 UI (예약 번호만 표시)
   - 티켓 다운로드 실패: 에러 안내 및 재시도
   - 네트워크 에러: 재시도 옵션
   - 세션 만료: 로그인 페이지로 리다이렉트

### 5.3 출력 (Output)
- 예약 상세 정보:
  - 상단: 예약 상태 배지, D-day
  - 콘서트 정보 섹션:
    - 포스터 이미지
    - 콘서트 제목
    - 날짜, 시간
    - 장소 (지도 보기 링크)
    - 출연진

- 좌석 정보 섹션:
  - 좌석 등급
  - 좌석 번호 목록
  - 총 좌석 수

- 티켓/QR코드 섹션:
  - QR코드 이미지
  - 예약 번호
  - 확대 보기 버튼
  - 다운로드 버튼

- 액션 버튼:
  - 티켓 공유
  - 캘린더에 추가
  - 예약 취소 (조건부 표시)

- 취소 정보 (취소된 예약):
  - 취소 날짜
  - 취소 사유

- 모달:
  - QR코드 전체화면
  - 지도 모달
  - 공유 모달

- 로딩 상태: 스켈레톤 UI
- 에러 상태: 에러 메시지 및 액션 버튼

### 5.4 엣지케이스
- 예약 ID가 유효하지 않음: 404 페이지
- 다른 사용자의 예약 접근: 403 에러 및 예약 내역으로 리다이렉트
- 이미 취소된 예약: 취소 정보 표시, 취소 버튼 숨김
- 공연 종료 후 조회: 과거 예약으로 표시, 일부 기능 비활성화
- QR코드 스캔 후 사용됨 (입장 완료): 사용 완료 배지
- 취소 가능 기간 경과: 취소 버튼 비활성화 및 안내
- 콘서트 취소/연기: 특별 안내 배너 표시
- 티켓 다운로드 실패 (저장공간 부족): 에러 안내
- QR코드 생성 실패: 예약 번호로 대체
- 공유 기능 미지원 브라우저: 복사 기능으로 대체
- 모바일에서 캘린더 앱 없음: 파일 다운로드로 대체
- 지도 API 로드 실패: 주소 텍스트만 표시
- 네트워크 끊김: 캐시된 데이터 표시 (오프라인 배지)
- 페이지 새로고침: 최신 상태로 재조회
- 포스터 이미지 로드 실패: 대체 이미지
- 매우 많은 좌석 (10개 이상): 접기/펼치기 UI
- 동시에 다른 기기에서 취소 처리: 실시간 상태 동기화

---

## 6. 예약 취소

### 6.1 입력 (Input)
- 예약 상세 페이지에서 예약 취소 버튼 클릭
- 취소 정책 확인
- 취소 사유 선택 (선택 사항)
- 취소 사유 상세 입력 (기타 선택 시)
- 취소 확인 체크박스 선택
- 최종 취소하기 버튼 클릭
- 취소 모달에서 닫기/뒤로가기 버튼 클릭

### 6.2 처리 (Process)
1. 취소 버튼 클릭 시:
   - 예약 상태 재확인
   - 이미 취소됨: 에러 메시지
   - 공연 종료: 취소 불가 안내
   - 취소 가능 기간 확인:
     - 취소 가능 기간 지남: 취소 불가 안내
     - 공연 시작 시간 기준 계산

2. 취소 정책 표시:
   - 취소 정책 안내 (공연 시작 시간 기준)
   - 취소 가능 기간 표시

3. 취소 사유 선택:
   - 사유 목록 표시:
     - 일정 변경
     - 중복 예약
     - 가격 문제
     - 단순 변심
     - 기타
   - 선택 사항이므로 스킵 가능
   - "기타" 선택 시: 텍스트 입력 필드 표시

4. 취소 확인 체크박스:
   - 필수 확인 사항:
     - 취소 정책 확인
     - 취소 후 복구 불가 안내
   - 체크 필수 (미체크 시 버튼 비활성화)

5. 최종 취소하기 버튼 클릭:
   - 체크박스 확인
   - 미체크 시: 에러 메시지
   - 체크 완료 시:
     - 최종 확인 다이얼로그 표시

6. 취소 처리:
   - 사용자 최종 확인 후:
     - 중복 클릭 방지 (버튼 비활성화)
     - 예약 취소 API 요청
     - 로딩 인디케이터 표시
   - 서버 처리:
     - 예약 상태를 "취소됨"으로 변경
     - 좌석 상태를 "판매 가능"으로 복원
     - 취소 내역 저장 (취소 날짜, 사유)
     - 이메일/SMS 알림 발송 트리거

7. 취소 완료:
   - 취소 완료 메시지 표시
   - 취소 정보 요약:
     - 취소된 예약 번호
   - 예약 상세 페이지로 복귀 (취소 상태로 갱신)
   - 또는 예약 내역 페이지로 이동

8. 취소 모달 닫기/뒤로가기:
   - 취소 진행 중 아님: 모달 닫기
   - 취소 진행 중: 확인 다이얼로그 (진행 중단 경고)

9. 에러 처리:
   - 이미 취소된 예약: 에러 메시지, 페이지 새로고침
   - 취소 가능 기간 경과: 취소 불가 안내
   - 취소 API 실패: 에러 메시지 및 재시도 옵션
   - 네트워크 에러: 재시도 옵션
   - 타임아웃: 재시도 옵션 (중복 취소 방지 체크)
   - 동시 취소 시도: 첫 번째 요청만 처리
   - 세션 만료: 로그인 페이지로 리다이렉트

### 6.3 출력 (Output)
- 취소 모달:
  - 제목: "예약 취소"
  - 경고 메시지 (복구 불가)

- 취소 정책 섹션:
  - 취소 정책 안내
  - 취소 가능 기간

- 취소 사유 선택 (선택 사항):
  - 라디오 버튼 목록
  - "기타" 선택 시 텍스트 입력 필드
  - 최대 글자 수 표시 (500자)

- 확인 체크박스:
  - 필수 확인 사항 텍스트
  - 체크박스

- 액션 버튼:
  - 최종 취소하기 (체크 시 활성화)
  - 돌아가기

- 최종 확인 다이얼로그:
  - 경고 메시지
  - 확인 버튼
  - 취소 버튼

- 처리 중:
  - 로딩 스피너
  - "취소 처리 중..." 메시지

- 취소 완료 화면:
  - 성공 아이콘
  - "예약이 취소되었습니다" 메시지
  - 취소 정보 요약
  - 확인 버튼

- 에러 상태:
  - 에러 메시지
  - 재시도 버튼
  - 고객센터 연락처

### 6.4 엣지케이스
- 이미 취소된 예약: 에러 메시지 및 상태 갱신
- 취소 가능 기간 경과 (시간 단위 체크): 취소 불가 안내
- 공연 시작 시간 임박 (1시간 이내): 추가 확인 다이얼로그
- 취소 처리 중 네트워크 끊김: 재연결 시 취소 상태 확인 (중복 방지)
- 취소 완료 후 페이지 새로고침: 취소 상태로 표시
- 동시에 다른 기기에서 취소: 첫 번째만 성공, 나머지는 이미 취소됨 에러
- 취소 사유 입력 시 욕설/비속어: 필터링 없이 그대로 저장 (관리자만 확인)
- 매우 긴 취소 사유: 글자 수 제한 (500자) 및 안내
- 모달 외부 클릭: 모달 닫기 (진행 중이 아닐 때만)
- ESC 키 입력: 모달 닫기
- 브라우저 뒤로가기: 모달 닫기
- 취소 완료 후 뒤로가기: 예약 상세 페이지 (취소 상태)
- API 타임아웃 후 실제로는 취소됨: 상태 재확인 로직
- 콘서트 자체가 취소된 경우: 별도 안내 처리
- 공연 연기된 경우: 취소가 아닌 변경 안내 (별도 프로세스)

---

## 부록

### 공통 엣지케이스
모든 유저플로우에 공통적으로 적용되는 엣지케이스:

- **세션 만료**: 모든 페이지에서 세션 만료 감지 시 로그인 페이지로 리다이렉트 (현재 경로 저장)
- **네트워크 단절**: 오프라인 감지 및 재연결 시 상태 동기화
- **브라우저 호환성**: 구형 브라우저에서 기능 제한 안내
- **JavaScript 비활성화**: 기본 HTML 폼으로 대체 (제한적 기능)
- **서버 점검**: 점검 안내 페이지 표시
- **과도한 API 요청**: Rate limiting 적용 및 안내
- **데이터 동기화 실패**: 재시도 로직 및 사용자 안내
- **예상치 못한 서버 에러**: 일반 에러 메시지 및 고객센터 연락처
- **XSS/CSRF 방어**: 입력 값 sanitization 및 토큰 검증
- **국제화(i18n)**: 다국어 지원 (향후 고려)

### 성능 최적화 고려사항

- **이미지 최적화**: 포스터 이미지 lazy loading, WebP 형식 사용
- **API 캐싱**: 자주 변경되지 않는 데이터 캐싱 (콘서트 상세 정보 등)
- **상태 관리**: 전역 상태와 로컬 상태 적절히 분리
- **번들 최적화**: 코드 스플리팅, 동적 import
- **디바운싱/쓰로틀링**: 검색, 필터, 스크롤 이벤트 최적화

---

**문서 종료**
